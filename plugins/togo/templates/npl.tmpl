<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type">
<title>pyTivo - ToGo</title>
<style type="text/css">

body {
    background-color: rgb(250, 250, 250)
}

tr.row1 {
    background-color: rgb(240, 240, 240)
}

span#title {
    font-size: xx-large
}

table#main {
    border: 1px solid rgb(220, 220, 220);
    background-color: rgb(255, 255, 255)
}

td.unbreak {
    white-space: nowrap;
    text-align: center
}

</style>
</head>
<body>

#set $tname = $tivoIP
#for $tsn in $tivos
    #if $tivoIP == $tivos[$tsn]
        #set $tname = $tivo_names[$tsn]
    #end if
#end for
<p style="text-align: center"><span id="title">pyTivo - ToGo - $tname</span></p>
<table id="main" border="0" cellpadding="0" cellspacing="4">
    <tr>
      <td>
      <div>
		  #if $ItemStart > 0
		        #set $Offset = -($ItemStart + 1)
		        #if $Offset < -($shows_per_page+1)
		           #set $Offset = -($shows_per_page+1)
		        #end if
		        <a href="/TiVoConnect?Command=NPL&amp;Container=$quote($container)&amp;TiVo=$tivoIP&amp;AnchorItem=$FirstAnchor&amp;AnchorOffset=$Offset&amp;Folder=$folder">Previous Page</a>
		  #end if
		  <table>
		  #if $folder != ''
		  	## We are in a subfolder, offer the option to return to NPL
			<tr><td colspan=5><a href="/TiVoConnect?Command=NPL&amp;Container=$quote($container)&amp;TiVo=$tivoIP">Back to Now Playing List</a></td></tr>
		  #end if
		  #set $i = 0
		  ## i variable is used to alternate colors of row
		  ## loop through passed data printing row for each show or folder
		  #for $row in $data
			  #set $i += 1
                          #set $j = $i%2
                          <tr class="row$(j)">
			  #if $row['ContentType'] == 'x-tivo-container/folder'
			    ## This is a folder
				<td></td>
				<td><a href='/TiVoConnect?Command=NPL&amp;Container=$quote($container)&amp;Folder=$(row["UniqueId"])&amp;TiVo=$tivoIP'>$row['Title'] </a></td>
				<td class="unbreak">$(row["TotalItems"]) Items</td>
				<td class="unbreak">$row["LastChangeDate"]</td>
				<td></td>
			  #else
			    ## This is a show
				#if 'Icon' in $row
				    <!-- Display small table with color similar to TiVo colored circles -->
					#if $row['Icon'] == 'urn:tivo:image:expires-soon-recording'
						<td><table><tr><td height="18" width="8" bgcolor="yellow"> </td></tr></table></td>
					#else if $row['Icon'] == 'urn:tivo:image:expired-recording'
						<td><table><tr><td height="18" width="8" bgcolor="yellow"><b> ! </b></td></tr></table></td>
					#else if $row['Icon'] == 'urn:tivo:image:save-until-i-delete-recording'
						<td><table><tr><td height="18" width="8" bgcolor="green"></td></tr></table></td>
					#else
						<td width="8"></td>
					#end if
				#else
				    ## No Icon listed in XML sheet
					<td width="4"></td>
				#end if
				<td width="*">
                                        #if 'episodeTitle' in $row
					<b>$row['title']: $row['episodeTitle']</b><br>
                                        #else
					<b>$row['title']</b><br>
                                        #end if
					<small>#if 'description' in $row
                                        $row['description']
                                        #end if
                                        #if 'displayMajorNumber' in $row and 'callsign' in $row
					$row['displayMajorNumber'] $row['callsign']
                                        #end if
                                        </small>
				</td>
				<td class="unbreak">$row['SourceSize'] <br>
				$row['Duration']
				</td>
				<td class="unbreak">$row['CaptureDate']</td>
				#if 'CopyProtected' in $row and $row['CopyProtected'] == 'Yes'
					<td>CopyProtected</td>
				#else if 'Url' in $row
					<td class="unbreak">
					#if $row['Url'] in $status
						#set $this_status = $status[$row['Url']]
						#if $this_status['running'] and $this_status['rate'] != ""
                                                        #set $gb = '%.3f GB' % (float($this_status['size']) / (1024 ** 3))
							Transfering - $this_status['rate'] KB/s<br>$gb
							<a href="/TiVoConnect?Command=ToGoStop&amp;Container=$quote($container)&amp;Url=$quote($row['Url'])&amp;TiVo=$tivoIP&amp;Redirect=NPL">Stop Transfer</a>
						#elif $this_status['running'] and $this_status['rate'] == ""
							Initiating Transfer.<br>
							Please Wait
						#elif $this_status['error']
							Error - $this_status['error']<br>
							<a href="/TiVoConnect?Command=ToGo&amp;Container=$quote($container)&amp;Url=$quote($row['Url'])&amp;TiVo=$tivoIP&amp;Redirect=NPL">Try Transfer Again.</a>
						#elif $this_status['finished']
							Transfer Complete
						#else
							Transfer Stopped<br>
							<a href="/TiVoConnect?Command=ToGo&amp;Container=$quote($container)&amp;Url=$quote($row['Url'])&amp;TiVo=$tivoIP&amp;Redirect=NPL">Try Transfer Again.</a>
						#end if
					#else
						<a href="/TiVoConnect?Command=ToGo&amp;Container=$quote($container)&amp;Url=$quote($row['Url'])&amp;TiVo=$tivoIP&amp;Redirect=NPL">Transfer This.</a>
					#end if
					</td>
				#else
				    ## No URL was in links url in XML
					<td></td>
				#end if
			  #end if
			  </tr>
		  #end for
		  </table>
		  #if ($TotalItems - $ItemCount) > ($ItemStart + 1)
		     #set $Offset = $shows_per_page - 1
		     <a href="/TiVoConnect?Command=NPL&amp;Container=$quote($container)&amp;TiVo=$tivoIP&amp;AnchorItem=$FirstAnchor&amp;AnchorOffset=$Offset&amp;Folder=$folder">Next Page</a>
		  #end if
      </div>
      </td>
    </tr>
</table>
</body>
</html>
